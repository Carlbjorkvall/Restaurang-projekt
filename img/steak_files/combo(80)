YUI.add("hermes-template-photo-well-media-interstitial-moola",function(a,e){var t=a.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(a,e,t,l,r){var i;return'<div class="photo-page-i-m-container">\n'+(null!=(i=a.invokePartial(l["prbd-moola-position"],e,{name:"prbd-moola-position",hash:{audienceTargets:null!=e?e.audienceTargets:e,signedOut:null!=e?e.signedOut:e,upsellFallback:null!=e?e.upsellFallback:e,adUnit:null!=e?e.adUnit:e,adTimerStartCount:null!=e?e.adTimerStartCount:e},data:r,indent:"\t",helpers:t,partials:l,decorators:a.decorators}))?i:"")+"</div>\n"},usePartial:!0,useData:!0}),l={};a.Array.each(["prbd-moola-position"],function(e){var t=a.Template.get("hermes/"+e);t&&(l[e]=t)}),a.Template.register("hermes/photo-well-media-interstitial-moola",function(e,r){return r=r||{},r.partials=r.partials?a.merge(l,r.partials):l,t(e,r)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-prbd-moola-position"]});YUI.add("photo-well-media-scrappy-view",function(e,t){var i,n=require("hermes-core/flog")(t);i={photo:{render:function(){var e,t,i,n=this,o=this.get("photo"),a="";return n.preloadImage&&(n.preloadImage.onload=null),this.appContext.forceServerRender?t=e=this.getPhotoForDisplay({canvas:{width:Number.MAX_VALUE,height:Number.MAX_VALUE}}):(e=this.getPhotoForDisplay(),t=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]})),o.getValue("owner")&&(a=""===o.getValue("title").trim()?this.intlMessage({intlName:"common.UNTITLED"}):o.getValue("title"),a+=" | "+this.intlMessage({intlName:"common.BY_USER",user:o.getValue("owner").getValue("username")})),(i=this.get("container").one(".main-photo"))&&parseInt(i.getAttribute("width"),10)===e.width&&parseInt(i.getAttribute("height"),10)===e.height||this.setContainerWithTemplate("photo-well-media-scrappy",{width:e.width,height:e.height,src:t.url,highResSrc:e.url,imgAltText:a,needsInterstitial:o.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:!1,isMinor:this.appContext.getViewer().isMinor}),YUI.Env.isServer?(this.serverWidth=e.width,this.serverHeight=e.height):o.getValue("needsInterstitial")||(n.preloadImage=new Image,n.preloadImage.onload=function(){if(!this.onloadFired&&n.isActiveAndInDOM()){this.onloadFired=!0;var e=n.get("container").one(".low-res-photo");n.get("container").one(".main-photo").removeClass("is-hidden").show(),e.hide()}},n.preloadImage.src=e.url,n.preloadImage.complete&&n.preloadImage.onload()),this}},video:{render:function(){var e=this.get("photo"),t=this.getPhotoForDisplay({excludeSizes:[]}),i=t.url;return this.appContext.flipper.isFlipped("disable-video-playback")&&(i="/images/en-us/video-unavailable.png"),!this.player||e.getValue("isVideoPending")||e.getValue("isVideoFailed")?(this.setContainerWithTemplate("photo-well-media-scrappy",{width:t.width,height:t.height,src:i,needsInterstitial:e.getValue("needsInterstitial"),isVideo:!0,isSignedIn:this.appContext.getViewer().signedIn,"zoom-view":""}),this):(e.getValue("isVideoPending")||e.getValue("isVideoFailed")||(this.player.dimension?(this.player.dimension("width",t.width),this.player.dimension("height",t.height)):this.player.resize(t.width,t.height)),this)}},ad:{render:function(){var t=e.config.flickr.moola.positions.interstitials[0],i={},n=this.appContext.viewportData.getWidth(),o=e.config.flickr.moola.ad_breakpoint_mobile_desktop;return this.adId=e.guid(),i.signedOut=!this.appContext.getViewer().signedIn,i.adTimerStartCount=t.ad_timer_start_value,i.adUnit=t[n<o?"ad_unit_mobile":"ad_unit_desktop"],i.audienceTargets=this.appContext.audienceTargets.getAudienceData(),this.setContainerWithTemplate("photo-well-media-interstitial-moola",i),this}}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"zoom-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"vr-overlay-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,destinationContainer:".photo-well-media-scrappy-view",disabled:function(){return!this.appContext.flipper.isFlipped("enable-vr")}}},initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,this.adSlots=[],""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var t=this;return this.appContext.getModel("photo-models",t.photoId).then(function(i){if(t.set("photo",i),i.getValue("isVideo"))return new e.Promise(function(t,i){e.use("flickr-video-player",function(){t()})})})},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?i.ad.render.call(this):this.get("photo").getValue("isVideo")?i.video.render.call(this):i.photo.render.call(this),!YUI.Env.isServer&&this.subviews["vr-overlay-view"]&&this.subviews["vr-overlay-view"].get("canVr")&&(this.canVR=!0,this.subviews["zoom-view"]&&this.subviews["zoom-view"].destroy({remove:!0})),this.get("photo").getValue("needsInterstitial")?this.get("container").addClass("has-interstitial"):this.get("container").removeClass("has-interstitial"),this},handleInterstitialDismissButtonClick:function(t){var i=this,o=this.get("personPreferences"),a=this.get("photo"),s=a.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),o.setValue("safeSearch",s),o.registry.remoteUpdate(i.appContext.auth.user.nsid).then(function(e){a.registry.attributeSearch({needsInterstitial:!0}).forEach(function(e){a.registry.getValue(e,"safetyLevel")<=o.getValue("safeSearch")&&a.registry.setValue(e,"needsInterstitial",!1)}),i.buildContainer(),i.fire("subviewViewEvent","photoWellResized")},function(e){n.error({err:e}),i.onError(i.intlMessage({intlName:"photo-page-scrappy.COULDNT_UPDATE_SETTINGS"}))})},onParentViewEvent:function(e,t){t&&"photoWellResized"===t[0]&&(this.get("photo").getValue("needsInterstitial")||(this.set("canvasSizeIsDirty",!0),this.buildContainer()))},activate:function(){var t=this;return!this.get("photo").getValue("isVideo")||this.get("photo").getValue("isVideoPending")||this.get("photo").getValue("isVideoFailed")||(this.player=new e.FlickrVideoPlayer({container:t.get("container").one(".videoplayer"),model:t.get("photo"),appContext:t.appContext,videoNode:e.one("#video_1")?e.one("#video_1").getDOMNode():null,controlBar:{fullscreenToggle:!1}}),this.player.init(),this.on("destroy",function(){t.player&&(t.player.destroy(),t.player=null)})),this.get("photo").getValue("needsInterstitial")||this.registerEventHandler(e.on("flickr:photo-media-well-update",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()})),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",this.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&!this.appContext.getViewer().isMinor&&t.get("container").one(".restricted-interstitial-message button")&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button").on("click",t.handleInterstitialDismissButtonClick,t))}),this.appContext.flipper.isFlipped("enable-sticky-ads")&&this.appContext.allowThirdPartyContent&&this.appContext.adManager.handleInfolinks(this.get("photo").getValue("owner").getValue("isPro")),this.isAd&&(this.appContext.flipper.isFlipped("enable-sticky-ads")&&this.appContext.adManager.stopInfolinksAdUnit(),asc.cmd.push(asc.processAdsOnPage),e.once("adPageChange",function(){t.fire("subviewViewEvent","adPageTimeoutStart")})),this},showUpsell:function(){var e=this.get("container"),t=e.one("#interstitial-photo-upsell"),i=e.one("iframe");t&&t.addClass("show-upsell"),i&&i.setStyle("display","none")},onError:function(t){new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:this.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),message:t,classList:"scrappy-dialog"}).show()},getPhotoForDisplay:function(e){var t,i,n,o=this.getCanvasSize(),a=this.getPixelRatio();return e&&e.canvasSize&&(o=e.canvasSize),t=this.get("photo").getSizeToFit(o,e),i=Math.min(o.height/a,t.height),n=Math.min(o.width/a,t.width/t.height*i),i=Math.min(i,t.height/t.width*n),{width:Math.round(n),height:Math.round(i),url:t.url,pixelRatio:t.width/n}},getCanvasSize:function(){var e,t,i,n,o,a,s=this.getPixelRatio(),r=this.get("container"),h={width:500,height:500};return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(t=this.get("container").ancestor(),i=r.getStyle("paddingTop")?parseInt(r.getStyle("paddingTop").match(/[0-9]+/)[0],10):0,n=r.getStyle("paddingBottom")?parseInt(r.getStyle("paddingBottom").match(/[0-9]+/)[0],10):0,a=40,o=40,t&&((e=t.get("region")).height=parseInt(t.getStyle("height").match(/[0-9]+/)[0],10)-(i+n),e.width=this.appContext.viewportData.viewport.width-(a+o))):e=this.get("cachedCanvasSize"),this.appContext.viewportData.viewport.width>0&&(h={width:this.appContext.viewportData.viewport.width,height:this.appContext.viewportData.viewport.height-240}),e||(e={top:0,left:0,bottom:500,right:500,width:h.width,height:h.height}),e.height*=s,e.width*=s,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})},"@VERSION@",{requires:["flickr-view","moment","vr-overlay-view","zoom-view","hermes-template-photo-well-media-scrappy","hermes-template-sub-photo-moola-view","hermes-template-photo-well-media-interstitial-moola"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});YUI.add("hermes-template-context-slider-photo",function(a,e){var n=a.Template.Handlebars.revive({1:function(a,e,n,l,t){return" currentImage"},3:function(a,e,n,l,t){return" previousImages"},5:function(a,e,n,l,t){return" nextImages"},7:function(a,e,n,l,t){return" restricted-image"},9:function(a,e,n,l,t){return"\t\t<span class='play-slideshow'>&#9654;</span>\n\t\t<span class='countdown-slideshow'></span>\n"},compiler:[7,">= 4.0.0"],main:function(a,e,n,l,t){var r,o,i=null!=e?e:{},s=n.helperMissing,u="function",c=a.escapeExpression;return'<a class="context-thumb emptyImage'+(null!=(r=n.if.call(i,null!=e?e.currentPhoto:e,{name:"if",hash:{},fn:a.program(1,t,0),inverse:a.noop,data:t}))?r:"")+(null!=(r=n.if.call(i,null!=e?e.previousBigPhotos:e,{name:"if",hash:{},fn:a.program(3,t,0),inverse:a.noop,data:t}))?r:"")+(null!=(r=n.if.call(i,null!=e?e.nextBigPhotos:e,{name:"if",hash:{},fn:a.program(5,t,0),inverse:a.noop,data:t}))?r:"")+(null!=(r=n.if.call(i,null!=e?e.needsInterstitial:e,{name:"if",hash:{},fn:a.program(7,t,0),inverse:a.noop,data:t}))?r:"")+'" href="'+c(typeof(o=null!=(o=n.url||(null!=e?e.url:e))?o:s)===u?o.call(i,{name:"url",hash:{},data:t}):o)+'" data-track="contextSliderNextPhotoClick" style="background-image: url('+c(typeof(o=null!=(o=n.background||(null!=e?e.background:e))?o:s)===u?o.call(i,{name:"background",hash:{},data:t}):o)+"); left: "+c(typeof(o=null!=(o=n.left||(null!=e?e.left:e))?o:s)===u?o.call(i,{name:"left",hash:{},data:t}):o)+'px" data-photo-id="'+c(typeof(o=null!=(o=n.id||(null!=e?e.id:e))?o:s)===u?o.call(i,{name:"id",hash:{},data:t}):o)+'" title="'+c(typeof(o=null!=(o=n.title||(null!=e?e.title:e))?o:s)===u?o.call(i,{name:"title",hash:{},data:t}):o)+'" tabindex="-1">\n'+(null!=(r=n.if.call(i,null!=e?e.currentPhoto:e,{name:"if",hash:{},fn:a.program(9,t,0),inverse:a.noop,data:t}))?r:"")+"</a>\n"},useData:!0}),l={};a.Array.each([],function(e){var n=a.Template.get("hermes/"+e);n&&(l[e]=n)}),a.Template.register("hermes/context-slider-photo",function(e,t){return t=t||{},t.partials=t.partials?a.merge(l,t.partials):l,n(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-context-slider-scrappy",function(t,n){var e=t.Template.Handlebars.revive({1:function(t,n,e,a,r){var l=null!=n?n:{},s=e.helperMissing,o=t.escapeExpression;return"\t<div class='loadingError'>\n\t\t<p>"+o((e.intlMessage||n&&n.intlMessage||s).call(l,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ERROR_LOADING_CONTEXT"},data:r}))+'</p>\n\t\t<p><button href="#" class="ui-button ui-button-cta ui-button-transparent retry">'+o((e.intlMessage||n&&n.intlMessage||s).call(l,{name:"intlMessage",hash:{intlName:"common.RETRY"},data:r}))+"</button></p>\n\t</div>\n"},3:function(t,n,e,a,r){var l,s=null!=n?n:{};return"\n\t<div class='context-slider small-slider "+(null!=(l=e.if.call(s,null!=n?n.slideshowEnabled:n,{name:"if",hash:{},fn:t.program(4,r,0),inverse:t.noop,data:r}))?l:"")+'\'>\n\n\t\t<div class="wrapper is-ready clear-float small-photos">\n\n\t\t\t<div class="slider">\n\n'+(null!=(l=e.each.call(s,null!=n?n.previousPhotos:n,{name:"each",hash:{},fn:t.program(6,r,0),inverse:t.noop,data:r}))?l:"")+"\n"+(null!=(l=e.if.call(s,null!=n?n["is-ad"]:n,{name:"if",hash:{},fn:t.program(8,r,0),inverse:t.program(10,r,0),data:r}))?l:"")+"\n\n"+(null!=(l=e.each.call(s,null!=n?n.nextPhotos:n,{name:"each",hash:{},fn:t.program(6,r,0),inverse:t.noop,data:r}))?l:"")+"\n\t\t\t</div>\n\n\t\t</div>\n\n\t</div>\n\n"+(null!=(l=e.if.call(s,null!=n?n.showBigSlider:n,{name:"if",hash:{},fn:t.program(13,r,0),inverse:t.noop,data:r}))?l:"")+"\n"},4:function(t,n,e,a,r){return"slideshowEnabled"},6:function(t,n,e,a,r){var l;return null!=(l=t.invokePartial(a["context-slider-photo"],n,{name:"context-slider-photo",data:r,indent:"\t\t\t\t\t",helpers:e,partials:a,decorators:t.decorators}))?l:""},8:function(t,n,e,a,r){return'\t\t\t\t\t<a class="context-thumb middle currentImage adThumb">Ad</a>\n'},10:function(t,n,e,a,r){var l;return null!=(l=e.each.call(null!=n?n:{},null!=n?n.currentPhoto:n,{name:"each",hash:{},fn:t.program(11,r,0),inverse:t.noop,data:r}))?l:""},11:function(t,n,e,a,r){var l;return null!=(l=t.invokePartial(a["context-slider-photo"],n,{name:"context-slider-photo",data:r,indent:"\t\t\t\t\t\t",helpers:e,partials:a,decorators:t.decorators}))?l:""},13:function(t,n,e,a,r){var l,s=null!=n?n:{},o=e.helperMissing,i=t.escapeExpression;return"\t\t<div class='context-slider big-slider "+(null!=(l=e.if.call(s,null!=n?n.slideshowEnabled:n,{name:"if",hash:{},fn:t.program(4,r,0),inverse:t.noop,data:r}))?l:"")+'\'>\n\n\t\t\t<span class="nav nav-l">\n\t\t\t\t<span class="hide-text">&larr;</span>\n\t\t\t</span>\n\n\t\t\t<div class="wrapper clear-float">\n\n\t\t\t\t<div class="slider">\n\n\t\t\t\t\t'+i((e.renderTrustedMarkup||n&&n.renderTrustedMarkup||o).call(s,null!=n?n.previousBigPhotos:n,{name:"renderTrustedMarkup",hash:{},data:r}))+"\n\n"+(null!=(l=e.if.call(s,null!=n?n["is-ad"]:n,{name:"if",hash:{},fn:t.program(14,r,0),inverse:t.program(16,r,0),data:r}))?l:"")+"\n\t\t\t\t\t"+i((e.renderTrustedMarkup||n&&n.renderTrustedMarkup||o).call(s,null!=n?n.nextBigPhotos:n,{name:"renderTrustedMarkup",hash:{},data:r}))+'\n\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t\t<span class="nav nav-r">\n\t\t\t\t<span class="hide-text">&rarr;</span>\n\t\t\t</span>\n\n\t\t</div>\n'},14:function(t,n,e,a,r){return'\t\t\t\t\t\t<a class="context-thumb middle currentImage adThumb">Ad</a>\n'},16:function(t,n,e,a,r){var l;return null!=(l=e.each.call(null!=n?n:{},null!=n?n.currentPhoto:n,{name:"each",hash:{},fn:t.program(17,r,0),inverse:t.noop,data:r}))?l:""},17:function(t,n,e,a,r){var l;return null!=(l=t.invokePartial(a["context-slider-photo"],n,{name:"context-slider-photo",data:r,indent:"\t\t\t\t\t\t\t",helpers:e,partials:a,decorators:t.decorators}))?l:""},compiler:[7,">= 4.0.0"],main:function(t,n,e,a,r){var l;return null!=(l=e.if.call(null!=n?n:{},null!=n?n.loadingError:n,{name:"if",hash:{},fn:t.program(1,r,0),inverse:t.program(3,r,0),data:r}))?l:""},usePartial:!0,useData:!0}),a={};t.Array.each(["context-slider-photo","context-slider-photo","context-slider-photo","context-slider-photo"],function(n){var e=t.Template.get("hermes/"+n);e&&(a[n]=e)}),t.Template.register("hermes/context-slider-scrappy",function(n,r){return r=r||{},r.partials=r.partials?t.merge(a,r.partials):a,e(n,r)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-context-slider-photo","hermes-template-context-slider-photo","hermes-template-context-slider-photo","hermes-template-context-slider-photo"]});YUI.add("hermes-template-context-image",function(e,a){var t=e.Template.Handlebars.revive({1:function(e,a,t,l,n){var r;return'\n\t<a data-loaded="false" style="left:'+e.escapeExpression("function"==typeof(r=null!=(r=t.left||(null!=a?a.left:a))?r:t.helperMissing)?r.call(null!=a?a:{},{name:"left",hash:{},data:n}):r)+';float:left;display:block;position:absolute;background-color:gray;height:40px;width:86px;border:1px solid transparent;" href="#">\n\t\t\n\t</a>\n\n'},compiler:[7,">= 4.0.0"],main:function(e,a,t,l,n){var r;return null!=(r=t.each.call(null!=a?a:{},null!=a?a.images:a,{name:"each",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?r:""},useData:!0}),l={};e.Array.each([],function(a){var t=e.Template.get("hermes/"+a);t&&(l[a]=t)}),e.Template.register("hermes/context-image",function(a,n){return n=n||{},n.partials=n.partials?e.merge(l,n.partials):l,t(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-context-text",function(e,t){var a=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,a,l,n){var r,s=null!=t?t:{},i=a.helperMissing,p=e.escapeExpression;return'\n\n<span data-loaded="true" style="left:'+p("function"==typeof(r=null!=(r=a.left||(null!=t?t.left:t))?r:i)?r.call(s,{name:"left",hash:{},data:n}):r)+';float:left;display:block;position:absolute;height:40px;width:86px;border:1px solid #ccc;" href="#">\n\t'+p("function"==typeof(r=null!=(r=a.text||(null!=t?t.text:t))?r:i)?r.call(s,{name:"text",hash:{},data:n}):r)+"\n</span>\n\n"},useData:!0}),l={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(l[t]=a)}),e.Template.register("hermes/context-text",function(t,n){return n=n||{},n.partials=n.partials?e.merge(l,n.partials):l,a(t,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});